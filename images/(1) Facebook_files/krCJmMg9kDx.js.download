if (self.CavalryLogger) { CavalryLogger.start_js(["sJPce"]); }

__d("canUseReactEditor",["UserAgent"],(function a(b,c,d,e,f,g){"use strict";var h=typeof b.getSelection==="function",i=h&&(c("UserAgent").isPlatform("iOS")||c("UserAgent").isPlatform("Linux")||c("UserAgent").isPlatform("Mac OS X")||c("UserAgent").isPlatform("Windows")||c("UserAgent").isPlatform("Chrome OS"))&&(c("UserAgent").isEngine("EdgeHTML >= 12")||c("UserAgent").isEngine("Gecko >= 16")||c("UserAgent").isEngine("Trident >= 5")||c("UserAgent").isEngine("WebKit >= 533.16")&&!c("UserAgent").isBrowser("Mobile Safari < 6"));function j(){return i}f.exports=j}),null);
__d("applyEmoticonToContentState",["EmoticonsList","applyEmoticonToContentBlock","getTextAfterNearestEntity"],(function a(b,c,d,e,f,g){"use strict";__p&&__p();var h=new RegExp(c("EmoticonsList").regexp.source,"g");function i(j,k){__p&&__p();var l=k.getAnchorKey(),m=k.getAnchorOffset(),n=j.getBlockForKey(l),o=c("getTextAfterNearestEntity")(n,m),p,q;while(q!==null){q=h.exec(o);if(q!==null)p=q}if(!p)return j;var r=p[1];if(!r&&m!==o.length)return j;var s=p[2],t=m-o.length,u=t+p.index+p[1].length,v=j.getBlockMap().set(l,c("applyEmoticonToContentBlock")(n,s,u));m-=s.length-1;return j.merge({blockMap:v,selectionBefore:k,selectionAfter:k.merge({anchorOffset:m,focusOffset:m})})}f.exports=i}),null);
__d("handleBeforeInputForEmoticon",["DraftModifier","EditorState","applyEmoticonToContentState"],(function a(b,c,d,e,f,g){__p&&__p();var h=new RegExp(/[\s\'\".,!?]/);function i(j,k){var l=j.getSelection();if(!l.isCollapsed()||!k||!h.test(k))return j;var m=j.getCurrentContent(),n=c("applyEmoticonToContentState")(m,l);if(n===m)return j;var o=c("DraftModifier").insertText(n,n.getSelectionAfter(),k);return c("EditorState").push(j,o,"insert-characters")}f.exports=i}),null);
__d("handleSoftNewlineForEmoticon",["DraftModifier","EditorState","applyEmoticonToContentState"],(function a(b,c,d,e,f,g){function h(i){var j=i.getCurrentContent(),k=i.getSelection(),l=c("applyEmoticonToContentState")(j,k),m=c("DraftModifier").splitBlock(l,j===l?k:l.getSelectionAfter());return c("EditorState").push(i,m,"split-block")}f.exports=h}),null);
__d("UFIMentionsInput.react",["cx","Arbiter","BanzaiScuba","Bootloader","ContentState","DOMVector","DraftModifier","EditorState","EmojiFormat","Input","Keys","MentionsInput.react","React","ReactDOM","SubscriptionsHandler","UFIConfig","UFIUIEvents","URI","addEmojiInput","addEmojiToEditorState","canUseReactEditor","clearImmediate","clickRefAction","containsNode","createEditorStateWithEntities","createMentionEntityForContentState","emptyFunction","getMentionsInputDecorator","getMentionsTextForContentState","getVisibleValueForContentState","handleBeforeInputForEmoticon","handleSoftNewlineForEmoticon","isSoftNewlineEvent","setImmediate"],(function a(b,c,d,e,f,g,h){"use strict";__p&&__p();var i,j,k=c("addEmojiInput")(c("MentionsInput.react")),l=new(c("BanzaiScuba"))("ufi_tinder",null,{addBrowserFields:true,addGeoFields:true,addPredictedGeographyFields:true,addMobileDeviceFields:true,addUser:true}),m=200,n="ufi_comment_composer",o="ufi_reply_composer",p=c("canUseReactEditor")();function q(w){var x=w.map(function(y){return{kind:"file",type:y.type,getAsFile:c("emptyFunction").thatReturns(y)}});return{clipboardData:{items:x}}}function r(){var w=arguments.length<=0||arguments[0]===undefined?{}:arguments[0];return c("createEditorStateWithEntities")({text:w.text||"",ranges:w.ranges,decorator:c("getMentionsInputDecorator")(),addEntityToContentStateFn:v})}function s(w){var x=/^image\//;return w.filter(function(y){return x.test(y.type)})}i=babelHelpers.inherits(t,c("React").Component);j=i&&i.prototype;function t(w){__p&&__p();j.constructor.call(this,w);u.call(this);this.$UFIMentionsInput1=false;var x="",y=[];if(this.props.initialData){x=this.props.initialData.value||"";y=this.props.initialData.mentions||[];y=y.map(function(A){return babelHelpers["extends"]({},A,{entity:{uid:A.uid,weakreference:A.weakreference}})})}var z=c("EditorState").moveSelectionToEnd(r({ranges:y,text:x}));this.state={bootloaded:false,fullRender:!!(this.props.initialData&&this.props.initialData.value),typeaheadReporter:null,editorState:z,mentionsSource:null,fallbackText:x}}t.prototype.componentWillMount=function(){__p&&__p();this.$UFIMentionsInput2=new(c("SubscriptionsHandler"))();this.$UFIMentionsInput2.addSubscriptions(c("Arbiter").subscribe("Story/delete",function(w,x){var y=x.split(":")[2];if(y===this.props.ftEntIdentifier)this.$UFIMentionsInput5()}.bind(this)),c("Arbiter").subscribe(c("UFIUIEvents").Comment,function(w,x){var y,z=this,A=x.ft_id,B=x.target;if(A!==this.props.ftEntIdentifier)return;if(c("containsNode")(c("ReactDOM").findDOMNode(this),B))(function(){var C=c("setImmediate")(function(){this.$UFIMentionsInput5()}.bind(z));z.$UFIMentionsInput2.addSubscriptions({remove:function D(){c("clearImmediate")(C)}})})()}.bind(this)),c("Arbiter").subscribe(c("UFIUIEvents").CommentPivot,function(w,x){var y,z=this,A=x.ft_id,B=x.target;if(A!==this.props.ftEntIdentifier)return;if(c("containsNode")(c("ReactDOM").findDOMNode(this),B))(function(){var C=c("setImmediate")(function(){this.$UFIMentionsInput5()}.bind(z));z.$UFIMentionsInput2.addSubscriptions({remove:function D(){c("clearImmediate")(C)}})})()}.bind(this)))};t.prototype.componentWillUnmount=function(){this.$UFIMentionsInput1=false;if(this.$UFIMentionsInput2)this.$UFIMentionsInput2.release();delete this.$UFIMentionsInput2};t.prototype.hasEnteredText=function(){return!!this.state.editorState.getCurrentContent().getPlainText().trim()};t.prototype.getText=function(){var w=this.state.editorState.getCurrentContent();return c("getMentionsTextForContentState")(w)};t.prototype.insertMention=function(w){__p&&__p();this.$UFIMentionsInput6(function(){__p&&__p();if(p){var x=this.state.editorState,y=x.getSelection(),z=x.getCurrentContent(),A=y.getStartKey(),B=y.getStartOffset(),C=z.getBlockForKey(A),D=void 0;z=c("createMentionEntityForContentState")(z,w);var E=z.getLastCreatedEntityKey();if(C.getText().substr(B-1,1).trim().length>0){var F=c("DraftModifier").replaceText(z,y," ");y=F.getSelectionAfter();D=c("DraftModifier").insertText(F,y,w.getTitle(),x.getCurrentInlineStyle(),E)}else D=c("DraftModifier").replaceText(z,y,w.getTitle(),x.getCurrentInlineStyle(),E);y=D.getSelectionAfter();D=c("DraftModifier").insertText(D,y," ");x=c("EditorState").push(x,D,"insert-fragment");x=c("EditorState").forceSelection(x,x.getSelection());this.setState({editorState:x});this.focus()}else{var G=c("ReactDOM").findDOMNode(this.refs.textarea);G instanceof HTMLElement&&G.focus();if(this.state.fallbackText.length)this.setState({fallbackText:this.state.fallbackText+" "+w.title});else this.setState({fallbackText:w.title})}}.bind(this))};t.prototype.insertEmoticon=function(w){__p&&__p();if(!p){this.setState({fallbackText:this.state.fallbackText+" "+w});return}var x=this.state.editorState,y=x.getCurrentContent(),z=x.getSelection(),A=y.getBlockForKey(z.getStartKey()).getText()[z.getStartOffset()-1];if(A&&A!==" ")w=" "+w;var B=y.getBlockForKey(z.getEndKey()).getText()[z.getEndOffset()];if(B&&B!==" ")w+=" ";var C=c("DraftModifier").replaceText(x.getCurrentContent(),x.getSelection(),w);x=c("EditorState").push(x,C,"insert-characters");x=c("EditorState").forceSelection(x,x.getSelection());this.setState({editorState:x})};t.prototype.insertEmoji=function(w){var x=c("EmojiFormat").codeArrayToUnicode(w);if(!p){this.setState({fallbackText:this.state.fallbackText+" "+x});return}c("addEmojiToEditorState")(x,this.state.editorState,this.$UFIMentionsInput7)};t.prototype.$UFIMentionsInput5=function(){this.state.typeaheadReporter&&this.state.typeaheadReporter.sessionEnd();this.setState({editorState:c("EditorState").moveFocusToEnd(r())})};t.prototype.submitComment=function(w){__p&&__p();var x=arguments.length<=1||arguments[1]===undefined?this.state:arguments[1],y=x.editorState.getCurrentContent(),z=c("getVisibleValueForContentState")(y),A=c("getMentionsTextForContentState")(y),B={visibleValue:z,encodedValue:A},C=c("Input").getValue(c("ReactDOM").findDOMNode(this.refs.proxyInput));if(C){var D=new(c("URI"))(b.location.href);l.addNormal("path",D.getPath());l.addNormal("proxy_value",C.substr(0,m));l.post()}var E=this.props.onEnterSubmit(B,w);if(E){var F=c("EditorState").push(x.editorState,c("ContentState").createFromText(""),"remove-range");this.setState({editorState:F})}return E};t.prototype.$UFIMentionsInput11=function(w){var x=s(w);if(x.length){this.props.onPaste(q(x));return true}return false};t.prototype.$UFIMentionsInput6=function(w){this.setState({fullRender:true},w)};t.prototype.$UFIMentionsInput24=function(){return c("React").createElement("div",{className:"_2xwx _289b"},c("React").createElement("textarea",{ref:"textarea",className:"UFIAddCommentInput _1os9 _2xww",name:"add_comment_text",placeholder:this.props.placeholder,spellCheck:true,onKeyDown:this.$UFIMentionsInput18,onChange:this.$UFIMentionsInput19,onBlur:this.$UFIMentionsInput20,onFocus:this.$UFIMentionsInput21,value:this.state.fallbackText}))};t.prototype.$UFIMentionsInput25=function(){if(!this.props.hideProxyInput){var w="_1osa mentionsHidden";return c("React").createElement("input",{className:w,name:"add_comment_text",ref:"proxyInput",onFocus:this.focus,tabIndex:"-1"})}return null};t.prototype.$UFIMentionsInput26=function(){var w="UFIAddCommentInput _1osb _1osc _2xww";return c("React").createElement("div",{onClick:this.$UFIMentionsInput23,className:"_2xwx",onFocus:this.$UFIMentionsInput23,onMouseOver:this.$UFIMentionsInput23,onSelect:c("emptyFunction"),onTouchStart:this.$UFIMentionsInput23,role:"presentation"},this.$UFIMentionsInput25(),c("React").createElement("div",{className:w},this.props.placeholder))};t.prototype.$UFIMentionsInput27=function(w){c("clickRefAction")("ufi",w.target,null,"FORCE")};t.prototype.$UFIMentionsInput28=function(){var w="UFIAddCommentInput _1osb _2xww",x=babelHelpers["extends"]({mentionSortFn:this.props.viewOptionsTypeObjectsOrder?this.$UFIMentionsInput22:null},this.props.viewProps);return c("React").createElement("div",{className:"_2xwx _289c",onClick:this.$UFIMentionsInput27,role:"presentation"},this.$UFIMentionsInput25(),c("React").createElement(k,{ref:"mentionsInput",ariaMultiline:true,className:w,editorState:this.state.editorState,onChange:this.$UFIMentionsInput7,mentionsSource:this.state.mentionsSource,role:"textbox",typeaheadView:this.props.viewComponent,typeaheadViewProps:x,spellCheck:true,placeholder:this.props.placeholder,onAddMention:this.$UFIMentionsInput17,onShowMentions:this.$UFIMentionsInput16,onFocus:this.$UFIMentionsInput15,onBlur:this.$UFIMentionsInput14,handleContentReturn:this.$UFIMentionsInput9,handleBeforeInput:this.$UFIMentionsInput10,handlePastedFiles:this.$UFIMentionsInput13,handleDroppedFiles:this.$UFIMentionsInput12,autoflip:this.props.autoflip,position:this.props.isBroadcasterUFI||this.props.isTahoeUFI||this.props.isLivingRoom?"above":null,webDriverTestID:this.props.replyCommentID?o:n}))};t.prototype.componentDidMount=function(){__p&&__p();var w,x=this;if(!p){if(this.state.fallbackText){var y=c("ReactDOM").findDOMNode(this.refs.textarea);y instanceof HTMLElement&&y.focus()}}else if(this.state.editorState.getCurrentContent().hasText())(function(){var z=c("setImmediate")(function(){this.focus()}.bind(x));x.$UFIMentionsInput2.addSubscriptions({remove:function A(){c("clearImmediate")(z)}})})();this.$UFIMentionsInput1=true};t.prototype.render=function(){if(!p)return this.$UFIMentionsInput24();if(!this.state.fullRender)return this.$UFIMentionsInput26();return this.$UFIMentionsInput28()};var u=function u(){__p&&__p();this.focus=function(){this.$UFIMentionsInput6(function(){if(p)this.refs.mentionsInput.focus();else{var w=c("ReactDOM").findDOMNode(this.refs.textarea);if(w instanceof HTMLElement)w.focus()}}.bind(this))}.bind(this);this.$UFIMentionsInput8=function(){__p&&__p();var w,x=this;if(this.props.monitorHeight)(function(){__p&&__p();var y=c("setImmediate")(function(){__p&&__p();if(!this.$UFIMentionsInput1)return;var z=p?c("ReactDOM").findDOMNode(this.refs.mentionsInput):c("ReactDOM").findDOMNode(this.refs.textarea);if(z instanceof HTMLElement){var A=c("DOMVector").getElementDimensions(z).y;if(A!==this.$UFIMentionsInput3){this.$UFIMentionsInput3=A;c("Arbiter").inform(c("UFIUIEvents").InputHeightChanged,{node:z})}}}.bind(x));x.$UFIMentionsInput2.addSubscriptions({remove:function z(){c("clearImmediate")(y)}})})()}.bind(this);this.$UFIMentionsInput7=function(w){if(this.props.onContentChange){var x=this.state.editorState.getCurrentContent(),y=w.getCurrentContent();if(x!==y)this.props.onContentChange(c("getMentionsTextForContentState")(y))}this.setState({editorState:w},this.$UFIMentionsInput8)}.bind(this);this.$UFIMentionsInput9=function(w,x){if(c("isSoftNewlineEvent")(w)){this.setState({editorState:c("handleSoftNewlineForEmoticon")(x)});return true}w.persist();this.setState(null,function(){this.submitComment(w,this.state)}.bind(this));return true}.bind(this);this.$UFIMentionsInput10=function(w,x){var y=c("handleBeforeInputForEmoticon")(x,w);if(y===x)return false;else{this.setState({editorState:y});return true}}.bind(this);this.$UFIMentionsInput12=function(w,x){return this.$UFIMentionsInput11(x)}.bind(this);this.$UFIMentionsInput13=function(w){return this.$UFIMentionsInput11(w)}.bind(this);this.$UFIMentionsInput14=function(){this.state.typeaheadReporter&&this.state.typeaheadReporter.sessionEnd();this.props.onBlur&&this.props.onBlur();c("Arbiter").inform(c("UFIUIEvents").Blur,{ftEntIdentifier:this.props.ftEntIdentifier,instanceID:this.props.instanceID,hasEnteredText:this.hasEnteredText()})}.bind(this);this.$UFIMentionsInput15=function(){__p&&__p();if(!this.state.bootloaded&&!this.$UFIMentionsInput4){this.$UFIMentionsInput4=true;c("Bootloader").loadModules(["TypeaheadMetricReporter","getMentionsSearchSource"],function(w,x){if(!this.$UFIMentionsInput1)return;var y=new w({event_name:"tinder_mentions"});y.sessionStart();var z=x(this.props.datasource,y,c("UFIConfig").showHashtagTypeahead);z.bootstrap();this.setState({typeaheadReporter:y,bootloaded:true,mentionsSource:z},function(){this.$UFIMentionsInput4=false}.bind(this))}.bind(this),"UFIMentionsInput.react")}else if(this.state.typeaheadReporter)this.state.typeaheadReporter.sessionStart();this.props.onFocus&&this.props.onFocus();c("Arbiter").inform(c("UFIUIEvents").Focus,{ftEntIdentifier:this.props.ftEntIdentifier,instanceID:this.props.instanceID})}.bind(this);this.$UFIMentionsInput16=function(w,x){if(this.state.typeaheadReporter)this.state.typeaheadReporter.reportResults(w.map(function(y){return y.getUniqueID()}))}.bind(this);this.$UFIMentionsInput17=function(w,x,y){if(this.state.typeaheadReporter){this.state.typeaheadReporter.reportSelect(w.getUniqueID(),w.getType(),x,y.button>=0);var z=this.state.typeaheadReporter;if(z){z.sessionEnd();z.sessionStart()}}}.bind(this);this.$UFIMentionsInput18=function(w){if(w.which!==c("Keys").RETURN)return;if(c("isSoftNewlineEvent")(w)||!this.state.fallbackText.trim())return;w.preventDefault();var x={visibleValue:this.state.fallbackText,encodedValue:this.state.fallbackText};if(this.props.onEnterSubmit(x,w))this.setState({fallbackText:""})}.bind(this);this.$UFIMentionsInput19=function(w){this.setState({fallbackText:w.target.value})}.bind(this);this.$UFIMentionsInput20=function(w){this.props.onBlur&&this.props.onBlur()}.bind(this);this.$UFIMentionsInput21=function(w){this.props.onFocus&&this.props.onFocus()}.bind(this);this.$UFIMentionsInput22=function(w,x){var y=w.getAuxiliaryData().renderType,z=x.getAuxiliaryData().renderType;if(y===z)return w.getOrder()-x.getOrder();var A=this.props.viewOptionsTypeObjectsOrder;return A.indexOf(y)-A.indexOf(z)}.bind(this);this.$UFIMentionsInput23=function(){this.$UFIMentionsInput6()}.bind(this)};function v(w,x){return x.createEntity("MENTION","IMMUTABLE",{id:w.uid,isWeak:w.weakreference})}f.exports=t}),null);
__d("OGHovercardFeedback",["Event","Arbiter","CSS","DOM","ScrollableArea","TextAreaControl","UFIUIEvents","ge"],(function a(b,c,d,e,f,g){__p&&__p();Object.assign(h,{init:function i(j,k,l){new h(j,k,l)}});function h(i,j,k){this._hovercard=i;this._focusListener=null;for(var l=0;l<j.length;l++)this.conditionClassOnHovercard(j[l],k);c("Arbiter").subscribe(c("UFIUIEvents").Comment,function(m,n){this._scrollComments(n.isinverted?"toTop":"toBottom")}.bind(this));i.subscribe("show",this._initCommentTextAreaAndFocusListener.bind(this))}Object.assign(h.prototype,{conditionClassOnHovercard:function i(j,k){var l=c("ge")(j);this._hovercard.subscribe("beforeshow",function(){c("CSS").addClass(l,k)});this._hovercard.subscribe("hide",function(){c("CSS").removeClass(l,k)})},_scrollComments:function i(j){var k=this._hovercard.getContent(),l=k&&c("DOM").scry(k,".uiScrollableAreaWrap")[0],m=l&&c("ScrollableArea").getInstance(l);if(j==="toTop")m&&m.scrollToTop();else m&&m.scrollToBottom()},_initCommentTextAreaAndFocusListener:function i(){var j=this._hovercard.getContent(),k=j&&c("DOM").scry(j,".ogHovercardFooter textarea")[0];if(k){var l=c("TextAreaControl").getInstance(k);if(l&&l.isEmpty())l.clear();if(this._focusListener)return;this._focusListener=c("Event").listen(k,"focus",this._scrollComments.bind(this))}}});f.exports=h}),null);